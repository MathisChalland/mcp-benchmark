generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

//============== Auth ==============//

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Whitelist {
  id    String @id @default(uuid())
  email String @unique

  @@map("whitelist")
}

// =============================================================================
// Core Business Entities
// =============================================================================

model Category {
  id          Int       @id(map: "pk_categories") @map("category_id") @db.SmallInt
  name        String    @map("category_name") @db.VarChar(15)
  description String?
  products    Product[]

  @@map("categories")
}

model Customer {
  id           String  @id(map: "pk_customers") @map("customer_id") @db.VarChar(5)
  companyName  String  @map("company_name") @db.VarChar(40)
  contactName  String? @map("contact_name") @db.VarChar(30)
  contactTitle String? @map("contact_title") @db.VarChar(30)
  address      String? @db.VarChar(60)
  city         String? @db.VarChar(15)
  region       String? @db.VarChar(15)
  postalCode   String? @map("postal_code") @db.VarChar(10)
  country      String? @db.VarChar(15)
  phone        String? @db.VarChar(24)
  fax          String? @db.VarChar(24)
  orders       Order[]

  @@map("customers")
}

model Employee {
  id              Int                 @id(map: "pk_employees") @map("employee_id") @db.SmallInt
  lastName        String              @map("last_name") @db.VarChar(20)
  firstName       String              @map("first_name") @db.VarChar(10)
  title           String?             @db.VarChar(30)
  titleOfCourtesy String?             @map("title_of_courtesy") @db.VarChar(25)
  birthDate       DateTime?           @map("birth_date") @db.Date
  hireDate        DateTime?           @map("hire_date") @db.Date
  address         String?             @db.VarChar(60)
  city            String?             @db.VarChar(15)
  region          String?             @db.VarChar(15)
  postalCode      String?             @map("postal_code") @db.VarChar(10)
  country         String?             @db.VarChar(15)
  homePhone       String?             @map("home_phone") @db.VarChar(24)
  extension       String?             @db.VarChar(4)
  notes           String?
  reportsToId     Int?                @map("reports_to") @db.SmallInt
  photoPath       String?             @map("photo_path") @db.VarChar(255)
  territories     EmployeeTerritory[]
  reportsTo       Employee?           @relation("EmployeeHierarchy", fields: [reportsToId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_employees_employees")
  subordinates    Employee[]          @relation("EmployeeHierarchy")
  orders          Order[]

  @@map("employees")
}

model Product {
  id              Int           @id(map: "pk_products") @map("product_id") @db.SmallInt
  name            String        @map("product_name") @db.VarChar(40)
  supplierId      Int?          @map("supplier_id") @db.SmallInt
  categoryId      Int?          @map("category_id") @db.SmallInt
  quantityPerUnit String?       @map("quantity_per_unit") @db.VarChar(20)
  unitPrice       Float?        @map("unit_price") @db.Real
  unitsInStock    Int?          @map("units_in_stock") @db.SmallInt
  unitsOnOrder    Int?          @map("units_on_order") @db.SmallInt
  reorderLevel    Int?          @map("reorder_level") @db.SmallInt
  discontinued    Int
  orderDetails    OrderDetail[]
  category        Category?     @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_products_categories")
  supplier        Supplier?     @relation(fields: [supplierId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_products_suppliers")

  @@map("products")
}

model Supplier {
  id           Int       @id(map: "pk_suppliers") @map("supplier_id") @db.SmallInt
  companyName  String    @map("company_name") @db.VarChar(40)
  contactName  String?   @map("contact_name") @db.VarChar(30)
  contactTitle String?   @map("contact_title") @db.VarChar(30)
  address      String?   @db.VarChar(60)
  city         String?   @db.VarChar(15)
  region       String?   @db.VarChar(15)
  postalCode   String?   @map("postal_code") @db.VarChar(10)
  country      String?   @db.VarChar(15)
  phone        String?   @db.VarChar(24)
  fax          String?   @db.VarChar(24)
  homepage     String?
  products     Product[]

  @@map("suppliers")
}

// =============================================================================
// Orders & Shipping
// =============================================================================

model Order {
  id             Int           @id(map: "pk_orders") @map("order_id") @db.SmallInt
  customerId     String?       @map("customer_id") @db.VarChar(5)
  employeeId     Int?          @map("employee_id") @db.SmallInt
  orderDate      DateTime?     @map("order_date") @db.Date
  requiredDate   DateTime?     @map("required_date") @db.Date
  shippedDate    DateTime?     @map("shipped_date") @db.Date
  shipVia        Int?          @map("ship_via") @db.SmallInt
  freight        Float?        @db.Real
  shipName       String?       @map("ship_name") @db.VarChar(40)
  shipAddress    String?       @map("ship_address") @db.VarChar(60)
  shipCity       String?       @map("ship_city") @db.VarChar(15)
  shipRegion     String?       @map("ship_region") @db.VarChar(15)
  shipPostalCode String?       @map("ship_postal_code") @db.VarChar(10)
  shipCountry    String?       @map("ship_country") @db.VarChar(15)
  details        OrderDetail[]
  customer       Customer?     @relation(fields: [customerId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_orders_customers")
  employee       Employee?     @relation(fields: [employeeId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_orders_employees")
  shipper        Shipper?      @relation(fields: [shipVia], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_orders_shippers")

  @@map("orders")
}

model OrderDetail {
  orderId   Int     @map("order_id") @db.SmallInt
  productId Int     @map("product_id") @db.SmallInt
  unitPrice Float   @map("unit_price") @db.Real
  quantity  Int     @db.SmallInt
  discount  Float   @db.Real
  order     Order   @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_order_details_orders")
  product   Product @relation(fields: [productId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_order_details_products")

  @@id([orderId, productId], map: "pk_order_details")
  @@map("order_details")
}

model Shipper {
  id          Int     @id(map: "pk_shippers") @map("shipper_id") @db.SmallInt
  companyName String  @map("company_name") @db.VarChar(40)
  phone       String? @db.VarChar(24)
  orders      Order[]

  @@map("shippers")
}

// =============================================================================
// Geographic & Territory Data
// =============================================================================

model Region {
  id          Int         @id(map: "pk_region") @map("region_id") @db.SmallInt
  description String      @map("region_description") @db.VarChar(60)
  territories Territory[]

  @@map("region")
}

model Territory {
  id          String              @id(map: "pk_territories") @map("territory_id") @db.VarChar(20)
  description String              @map("territory_description") @db.VarChar(60)
  regionId    Int                 @map("region_id") @db.SmallInt
  employees   EmployeeTerritory[]
  region      Region              @relation(fields: [regionId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_territories_region")

  @@map("territories")
}

// =============================================================================
// Join Tables
// =============================================================================

model EmployeeTerritory {
  employeeId  Int       @map("employee_id") @db.SmallInt
  territoryId String    @map("territory_id") @db.VarChar(20)
  employee    Employee  @relation(fields: [employeeId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_employee_territories_employees")
  territory   Territory @relation(fields: [territoryId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_employee_territories_territories")

  @@id([employeeId, territoryId], map: "pk_employee_territories")
  @@map("employee_territories")
}
